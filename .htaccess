# StayHustler SEO Redirect Rules
# =============================================================================
# Enforces canonical host: https://stayhustler.com (non-www)
# All redirects are single-hop 301s that preserve path and query string.
# =============================================================================

# Enable RewriteEngine
RewriteEngine On

# -----------------------------------------------------------------------------
# RULE 1: Redirect www to non-www (single 301 hop)
# Handles both http and https in one rule by preserving the scheme
# -----------------------------------------------------------------------------
RewriteCond %{HTTP_HOST} ^www\.stayhustler\.com$ [NC]
RewriteRule ^(.*)$ https://stayhustler.com/$1 [R=301,L,QSA]

# -----------------------------------------------------------------------------
# RULE 2: Redirect http to https (for non-www only, www already handled above)
# This catches http://stayhustler.com and redirects to https://stayhustler.com
# -----------------------------------------------------------------------------
RewriteCond %{HTTPS} !=on
RewriteCond %{HTTP_HOST} ^stayhustler\.com$ [NC]
RewriteRule ^(.*)$ https://stayhustler.com/$1 [R=301,L,QSA]

# -----------------------------------------------------------------------------
# RULE 3: Redirect guide URLs without .html extension to .html version
# Fixes 404s from external links missing the extension
# -----------------------------------------------------------------------------
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^guides/([^/]+)$ /guides/$1.html [R=301,L]

# -----------------------------------------------------------------------------
# Notes on redirect behavior:
#
# http://www.stayhustler.com/path?q=1  -> https://stayhustler.com/path?q=1 (1 hop)
# https://www.stayhustler.com/path?q=1 -> https://stayhustler.com/path?q=1 (1 hop)
# http://stayhustler.com/path?q=1      -> https://stayhustler.com/path?q=1 (1 hop)
# https://stayhustler.com/path?q=1     -> (no redirect, serves content)
#
# QSA flag ensures query strings are preserved.
# L flag stops processing after match.
# NC flag makes host matching case-insensitive.
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Security headers
# -----------------------------------------------------------------------------
<IfModule mod_headers.c>
    # Prevent clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"

    # Prevent MIME type sniffing
    Header always set X-Content-Type-Options "nosniff"

    # Enable XSS filter
    Header always set X-XSS-Protection "1; mode=block"

    # Referrer policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# -----------------------------------------------------------------------------
# Caching for static assets
# -----------------------------------------------------------------------------
<IfModule mod_expires.c>
    ExpiresActive On

    # Images
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"

    # Fonts
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType application/font-woff2 "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"

    # CSS and JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"

    # HTML - short cache for content updates
    ExpiresByType text/html "access plus 1 hour"
</IfModule>

# -----------------------------------------------------------------------------
# Compression
# -----------------------------------------------------------------------------
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
    AddOutputFilterByType DEFLATE application/javascript application/json
    AddOutputFilterByType DEFLATE application/xml application/xhtml+xml
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# -----------------------------------------------------------------------------
# Error documents
# -----------------------------------------------------------------------------
ErrorDocument 404 /404.html
